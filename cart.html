<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITECH | Cart</title>
<script src="auth.js"></script>
<link rel="stylesheet" href="style.css">
<style>
    body{
margin:0;
font-family:Arial;
background:#111;
color:white;
}

.main-header{
display:flex;
justify-content:space-between;
align-items:center;
padding:15px 8%;
background:#8B0000;
}

.logo{
font-size:22px;
font-weight:bold;
color:gold;
}

.header-search{
width:40%;
padding:10px;
border-radius:25px;
border:none;
}

.nav-icons a{
color:white;
text-decoration:none;
margin-left:15px;
}

.products{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:20px;
padding:30px 8%;
}

.card{
background:#1a1a1a;
padding:20px;
border-radius:10px;
text-align:center;
}

.card img{
width:100%;
border-radius:10px;
}

button{
background:gold;
color:black;
border:none;
padding:10px;
border-radius:20px;
cursor:pointer;
margin-top:10px;
}

button:hover{
background:#ffcc00;
}

.cart-page{
padding:40px 8%;
}

.cart-item{
margin-bottom:10px;
border-bottom:1px solid #333;
padding-bottom:5px;
}

@media(max-width:768px){
.header-search{
width:100%;
margin:10px 0;
}
.main-header{
flex-direction:column;
align-items:flex-start;
}
}
</style>
</head>
<body>

<header class="main-header">
  <div class="logo">ITECH-STORE</div>
  <div class="nav-icons">
    <a href="products.html">üõç Back to Shop</a>
  </div>
</header>

<div class="cart-page">
<h2>Your Cart</h2>
<div id="cartItems"></div>
<h3>Total: ‚Ç¶<span id="totalPrice">0</span></h3>
<button onclick="checkout()">Checkout via WhatsApp</button>
</div>

<script>
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

function displayCart(){
let container=document.getElementById("cartItems");
let total=0;
container.innerHTML="";

cart.forEach((item,index)=>{
total+=item.price;
container.innerHTML+=`
<div class="cart-item">
${item.name} - ‚Ç¶${item.price}
<button onclick="removeItem(${index})">Remove</button>
</div>
`;
});

document.getElementById("totalPrice").innerText=total;
}

function removeItem(index){
cart.splice(index,1);
localStorage.setItem("cart",JSON.stringify(cart));
displayCart();
}

function checkout(){
if(cart.length===0){
alert("Cart is empty!");
return;
}

let message="Hello ITECH, I want to order:%0A";
let total=0;

cart.forEach(item=>{
message+=`- ${item.name} (‚Ç¶${item.price})%0A`;
total+=item.price;
});

message+=`%0ATotal: ‚Ç¶${total}`;
window.open(`https://wa.me/2349162249670?text=${message}`);
}

displayCart();

// Get current logged-in user
function getCurrentUser() {
  const loggedIn = JSON.parse(localStorage.getItem('loggedInUser'));
  return loggedIn; // {name,email}
}

// Save cart for current user
function saveCart(cart) {
  const user = getCurrentUser();
  if (!user) return;
  let allCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
  allCarts[user.email] = cart;
  localStorage.setItem('userCarts', JSON.stringify(allCarts));
}

// Load cart for current user
function loadCart() {
  const user = getCurrentUser();
  if (!user) return [];
  const allCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
  return allCarts[user.email] || [];
}

// Add to cart
function addToCart(name, price) {
  const user = getCurrentUser();
  if (!user) { alert('Please login first'); toggleSections('login'); return; }
  cart.push({name, price});
  updateCart();
}

// Update Cart UI
function updateCart() {
  let ci = document.getElementById("cartItems"); let total = 0; ci.innerHTML = "";
  cart.forEach((item,i)=>{total+=item.price; ci.innerHTML += `<div class="cart-item">${item.name} - ‚Ç¶${item.price} <button onclick="removeItem(${i})">Remove</button></div>`;});
  document.getElementById("totalPrice").innerText = total;
  document.getElementById("cartCount").innerText = cart.length;
  saveCart(cart); // Save cart for user
}

// Remove item
function removeItem(i){ cart.splice(i,1); updateCart(); }

// On login, load user cart
function loginUser(){
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;
  let users = JSON.parse(localStorage.getItem("users")||"[]");
  const user = users.find(u=>u.email===email && u.pass===pass);
  if(user){
    localStorage.setItem('loggedInUser', JSON.stringify({name:user.name,email:user.email}));
    displayGreeting(user.name);
    cart = loadCart();  // Load their cart
    updateCart();
  } else alert("Invalid email or password");
}

// Logout
function logout(){
  localStorage.removeItem('loggedInUser');
  document.getElementById("userGreeting").innerHTML="";
  cart=[]; updateCart();
  toggleSections('login');
}






// Get current logged-in user
function getCurrentUser() {
  const loggedIn = JSON.parse(localStorage.getItem('loggedInUser'));
  return loggedIn; // {name,email}
}

// Save cart for current user
function saveCart(cart) {
  const user = getCurrentUser();
  if (!user) return;
  let allCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
  allCarts[user.email] = cart;
  localStorage.setItem('userCarts', JSON.stringify(allCarts));
}

// Load cart for current user
function loadCart() {
  const user = getCurrentUser();
  if (!user) return [];
  const allCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
  return allCarts[user.email] || [];
}

// Add to cart
function addToCart(name, price) {
  const user = getCurrentUser();
  if (!user) { alert('Please login first'); toggleSections('login'); return; }
  cart.push({name, price});
  updateCart();
}

// Update Cart UI
function updateCart() {
  let ci = document.getElementById("cartItems"); let total = 0; ci.innerHTML = "";
  cart.forEach((item,i)=>{total+=item.price; ci.innerHTML += `<div class="cart-item">${item.name} - ‚Ç¶${item.price} <button onclick="removeItem(${i})">Remove</button></div>`;});
  document.getElementById("totalPrice").innerText = total;
  document.getElementById("cartCount").innerText = cart.length;
  saveCart(cart); // Save cart for user
}

// Remove item
function removeItem(i){ cart.splice(i,1); updateCart(); }

// On login, load user cart
function loginUser(){
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;
  let users = JSON.parse(localStorage.getItem("users")||"[]");
  const user = users.find(u=>u.email===email && u.pass===pass);
  if(user){
    localStorage.setItem('loggedInUser', JSON.stringify({name:user.name,email:user.email}));
    displayGreeting(user.name);
    cart = loadCart();  // Load their cart
    updateCart();
  } else alert("Invalid email or password");
}

// Logout
function logout(){
  localStorage.removeItem('loggedInUser');
  document.getElementById("userGreeting").innerHTML="";
  cart=[]; updateCart();
  toggleSections('login');
}
</script>
<script src="theme.js"></script>
</body>
</html>